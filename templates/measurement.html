{% extends "base.html" %}
<!-- Indique que ce template utilise le fichier "base.html" comme base structurelle -->
<!-- Cela permet de rÃ©utiliser l'en-tÃªte HTML, le logo, les blocs communs et de ne dÃ©finir ici que le contenu spÃ©cifique Ã  la page de mesure -->

{% block title %}Mesure de Force et d'angle en Temps Reel{% endblock %}
<!-- Bloc permettant de dÃ©finir dynamiquement le titre affichÃ© dans l'onglet du navigateur -->
<!-- Ici, on Ã©crase le titre par dÃ©faut du template "base.html" pour l'adapter Ã  la page de mesure -->

{% block head %}
{# Debut du bloc head pour ajouter des fichiers CSS specifiques a cette page #}

    <link rel="stylesheet" href="{{ url_for('static', filename='css/measurement.css') }}">
    <!-- Lien vers une feuille de style CSS spÃ©cifique Ã  cette page -->
    <!-- rel="stylesheet" : Indique qu'il s'agit d'un fichier CSS -->
    <!-- href : DÃ©finit le chemin vers ce fichier CSS -->
    <!-- {{ url_for(...) }} : GÃ©nÃ¨re dynamiquement l'URL absolue en fonction du nom du fichier (ici : static/css/measurement.css) -->

{% endblock %}

{% block content %}
<!-- Bloc principal du corps de la page : tout ce qui s'affichera Ã  l'intÃ©rieur du <main> de base.html -->

<!-- Texte patient en haut -->
<div class="info">
<!-- Conteneur textuel affichant les informations liÃ©es au patient actuellement sÃ©lectionnÃ© -->
<!-- class="info" : Sert Ã  appliquer un style CSS pour l'apparence de cette zone -->

    Patient : <span class="highlight">{{ patient.patient_name }}</span> |
    <!-- Affiche le nom du patient en gras ou en surbrillance grÃ¢ce Ã  la classe "highlight" -->
    <!-- {{ patient.patient_name }} : Valeur dynamique injectÃ©e cÃ´tÃ© serveur par Jinja2 -->

    Doigt : <span class="highlight">{{ patient.finger }}</span> |
    <!-- Affiche le doigt mesurÃ© (index, majeur...) -->

    Phalange : <span class="highlight">{{ patient.phalange }}</span> |
     <!-- Affiche la section du doigt mesurÃ©e (ex. proximale, distale...) -->

    Operateur : <span class="highlight">{{ patient.operator }}</span>
    <!-- Affiche le nom de lâ€™opÃ©rateur ayant effectuÃ© la mesure -->
</div>

<!-- Bouton Sauvegarder -->
<div class="save-button-container">
    <!-- Conteneur pour centrer ou styliser le bouton "Sauvegarder les donnÃ©es" -->
    <button id="saveButton">Sauvegarder les donnees</button>
    <!-- <button> : Ã‰lÃ©ment HTML interactif permettant de dÃ©clencher une action (ici : enregistrer les donnÃ©es) -->
    <!-- id="saveButton" : Identifiant utilisÃ© par JavaScript pour attacher un Ã©vÃ©nement onclick -->

</div>

<!-- Nouveau graphique : Force en fonction de l'angle libre -->
<div id="phalange-force-container">
    <!-- Conteneur pour afficher un graphique croisant la force mesurÃ©e et l'angle (dans le plan libre, pas contraint) -->

    <h2 style="text-align: center;">Force en fonction de l'angle mesurÃ© (libre)</h2>
    <!-- Titre du graphique centrÃ© horizontalement -->

    <div id="graph-force-vs-angle"></div>
    <!-- Zone vide (conteneur) destinÃ©e Ã  recevoir un graphique gÃ©nÃ©rÃ© dynamiquement par JavaScript (Plotly.js) -->
</div>

<!-- Bloc principal qui contient graphiques + bouton -->
<div id="measurement-page">
    <!-- Conteneur global regroupant tous les graphes, boutons, interactions de la page de mesure -->


    <div id="graphs-container">
    <!-- Sous-bloc contenant les graphes de force et d'angle, organisÃ©s en deux panneaux (gauche/droite) -->

        <div id="left-panel">
        <!-- Panneau gauche : affichera le graphe de la force en fonction du temps -->
            <h2>Force en fonction du temps</h2>
            <!-- <h2> : Balise HTML pour sous-titre de la force en fonction du temps -->
            <div id="graph-force"></div>
            <!-- Zone vide Ã  remplir dynamiquement avec un graphique via JavaScript -->
        </div>

        <div id="separator"></div>
        {# Petite barre verticale qui separe le panneau gauche du panneau droit #}
        <!-- SÃ©parateur visuel vertical entre les deux panneaux -->

        <div id="right-panel">
            <!-- Panneau droit : affichera le graphe de l'amplitude articulaire (angle) dans le temps -->
            <h2>Amplitude en fonction du temps</h2>
            
            <div id="angle-values" style="text-align: center; margin-bottom: 10px;">
             <!-- Affiche les deux valeurs d'angle actuelles (proximal et distal) en haut du graphique -->
            <strong>Angle distal :</strong> <span id="angle-distal">â€“</span> Â°
            <!-- <strong> : Label statique en gras -->
            <!-- <span> : Valeur dynamique qui sera mise Ã  jour via JavaScript (ex : 35.2Â°) -->

                &nbsp;&nbsp;&nbsp;
                <!-- Espacement horizontal visuel entre les deux valeurs -->
                <strong>Angle proximal :</strong> <span id="angle-proximal">â€“</span> Â°
                <!-- MÃªme principe que ci-dessus mais pour l'autre articulation -->
            </div>

            {# Titre pour le panneau d'amplitude #}
            <div id="graph-amplitude"></div>
            <!-- Conteneur vide qui recevra dynamiquement le graphique d'angle vs. temps via JavaScript -->
        </div>
    </div>

    <!-- Bouton Afficher / Cacher les graphiques -->
    <div style="text-align: center; margin-top: 10px;">
        <button id="toggleGraphsButton">Cacher les graphiques</button>
        <!-- Permet d'afficher ou de masquer dynamiquement les graphes avec un effet JavaScript -->
    </div>


    <div class="new-measure-container">
        <!-- Conteneur centrÃ© pour afficher le bouton "Nouvelle mesure" -->
        {# Conteneur pour centrer le bouton Nouvelle mesure sous les graphes #}
        <button id="newMeasureButton">Nouvelle mesure</button>
         <!-- Ce bouton redirige l'utilisateur vers la page d'accueil  -->
    </div>

</div>

{% endblock %}
<!-- Fin du bloc principal de contenu propre Ã  la page de mesure -->

{% block scripts %}
<!-- Bloc dâ€™inclusion des scripts spÃ©cifiques Ã  cette page (JS externes, bibliothÃ¨ques CDN, etc.) -->
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <!-- Charge la bibliothÃ¨que Socket.IO (version CDN) -->
    <!-- UtilisÃ©e pour Ã©tablir une connexion en temps rÃ©el (WebSocket) entre le navigateur et le serveur Python/Flask -->


    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Charge la bibliothÃ¨que Plotly.js permettant de dessiner des graphiques interactifs (ex : force, amplitude) -->

    <script>
        window.DEBUG = true;  // Activer ou dÃ©sactiver tous les logs
        window.blockedPhalange = "{{ patient.phalange|lower }}";
        <!-- Injecte la phalange actuelle dans une variable JavaScript globale accessible dans measurement.js -->
        if (window.DEBUG) {
            console.log("ðŸ“¦ Phalange bloquÃ©e (depuis Jinja):", window.blockedPhalange);
            // <!-- Affiche la valeur dans la console pour vÃ©rification/debug -->
        }
    </script>

    <script src="{{ url_for('static', filename='js/measurement.js') }}"></script>
    <!-- Fichier JavaScript principal de la page, gÃ¨re l'affichage, les Ã©vÃ©nements et les interactions dynamiques -->
    <!-- url_for(...) : Permet de pointer dynamiquement vers ce fichier dans le dossier static/js -->


{% endblock %}
<!-- Fin du bloc des scripts propres Ã  cette page -->


{% extends "base.html" %}
<!-- Indique que ce template utilise le fichier "base.html" comme base structurelle -->
<!-- Cela permet de rÃ©utiliser l'en-tÃªte HTML, le logo, les blocs communs et de ne dÃ©finir ici que le contenu spÃ©cifique Ã  la page de mesure -->

{% block title %}Mesure de Force et d'angle en Temps Reel{% endblock %}
<!-- Bloc permettant de dÃ©finir dynamiquement le titre affichÃ© dans l'onglet du navigateur -->
<!-- Ici, on Ã©crase le titre par dÃ©faut du template "base.html" pour l'adapter Ã  la page de mesure -->

{% block head %}
{# Debut du bloc head pour ajouter des fichiers CSS specifiques a cette page #}

    <link rel="stylesheet" href="{{ url_for('static', filename='css/measurement.css') }}">
    <!-- Lien vers une feuille de style CSS spÃ©cifique Ã  cette page -->
    <!-- rel="stylesheet" : Indique qu'il s'agit d'un fichier CSS -->
    <!-- href : DÃ©finit le chemin vers ce fichier CSS -->
    <!-- les accolades: GÃ©nÃ¨re dynamiquement l'URL absolue en fonction du nom du fichier (ici : static/css/measurement.css) -->

{% endblock %}

{% block content %}
<!-- Bloc principal du corps de la page : tout ce qui s'affichera Ã  l'intÃ©rieur du <main> de base.html -->

<!-- Texte patient en haut -->
<div class="info">
<!-- Conteneur textuel affichant les informations liÃ©es au patient actuellement sÃ©lectionnÃ© -->
<!-- class="info" : Sert Ã  appliquer un style CSS pour l'apparence de cette zone -->

    Patient : <span class="highlight">{{ patient.patient_name }}</span> |
    <!-- Affiche le nom du patient en gras ou en surbrillance grÃ¢ce Ã  la classe "highlight" -->
    <!--  patient.patient_name  : Valeur dynamique injectÃ©e cÃ´tÃ© serveur par Jinja2 -->

    Doigt : <span class="highlight">{{ patient.finger }}</span> |
    <!-- Affiche le doigt mesurÃ© (index, majeur...) -->

    Phalange : <span class="highlight">{{ patient.phalange }}</span> |
     <!-- Affiche la section du doigt mesurÃ©e (ex. proximale, distale...) -->

    Operateur : <span class="highlight">{{ patient.operator }}</span>
    <!-- Affiche le nom de lâ€™opÃ©rateur ayant effectuÃ© la mesure -->
</div>

<!-- Bouton Sauvegarder -->
<div class="save-button-container">
    <!-- Conteneur pour centrer ou styliser le bouton "Sauvegarder les donnÃ©es" -->
    <button id="saveButton">Sauvegarder les donnees</button>
    <!-- <button> : Ã‰lÃ©ment HTML interactif permettant de dÃ©clencher une action (ici : enregistrer les donnÃ©es) -->
    <!-- id="saveButton" : Identifiant utilisÃ© par JavaScript pour attacher un Ã©vÃ©nement onclick -->

</div>

<!-- Nouveau graphique : Force en fonction de l'angle libre -->
<div id="phalange-force-container">
    <!-- Conteneur pour afficher un graphique croisant la force mesurÃ©e et l'angle (dans le plan libre, pas contraint) -->

    <!-- Balise HTML <h2> utilisÃ©e pour afficher un sous-titre visible sur la page -->
    <!-- Lâ€™attribut style="text-align: center;" centre le texte horizontalement dans la page -->
    <h2 style="text-align: center;">

    <!-- VÃ©rifie si la phalange bloquÃ©e est "proximale" -->
    {% if patient.phalange == "proximale" %}

        <!-- Affiche la phrase avec une coloration rouge uniquement sur "Distale - IntermÃ©diaire" -->
        Force en fonction de l'angle mesurÃ© : 
        <span style="color: #d9534f; font-weight: bold;">Distale - IntermÃ©diaire</span>

    <!-- Sinon, si la phalange bloquÃ©e est "distale" -->
    {% elif patient.phalange == "distale" %}

        <!-- Affiche la phrase avec une coloration bleue uniquement sur "IntermÃ©diaire - Proximale" -->
        Force en fonction de l'angle mesurÃ© : 
        <span style="color: #007bff; font-weight: bold;">IntermÃ©diaire - Proximale</span>

    <!-- Cas par dÃ©faut : phalange non prÃ©cisÃ©e -->
    {% else %}

        <!-- Texte neutre sans coloration spÃ©cifique -->
        Force en fonction de l'angle mesurÃ© (libre)

    {% endif %}

    <!-- Fermeture de la balise <h2> -->
    </h2>


    <div id="graph-force-vs-angle"></div>
    <!-- Zone vide (conteneur) destinÃ©e Ã  recevoir un graphique gÃ©nÃ©rÃ© dynamiquement par JavaScript (Plotly.js) -->
</div>

<!-- Bloc principal qui contient les deux graphes et le bouton de contrÃ´le -->
<div id="measurement-page">
    <!-- Conteneur principal de tous les graphes de la page de mesure -->
    
    <div id="graphs-container">
        <!-- Conteneur horizontal : divise en deux panneaux les deux types de graphique -->

        <div id="left-panel">
            <!-- Panneau de gauche : contient le graphe de la force en fonction du temps -->
            <h2>Force en fonction du temps</h2>
            <div id="graph-force"></div>
        </div>

        <div id="separator"></div>
        <!-- Barre verticale de sÃ©paration visuelle entre les deux panneaux -->

        <div id="right-panel">
            <!-- Panneau de droite : contient le graphe de lâ€™amplitude articulaire -->
            <h2>Amplitude en fonction du temps</h2>

            <div id="angle-values" style="text-align: center; margin-bottom: 10px;">
                <!-- Conteneur centrÃ© affichant les deux valeurs d'angle (distal et proximal) -->
                <!-- style="text-align: center;" : centre le texte horizontalement -->
                <!-- margin-bottom: 10px; : ajoute un espacement vers le bas pour sÃ©parer visuellement ce bloc du graphique -->

                <strong style="color: #d9534f; font-weight: bold;">
                    <!-- Affiche le texte statique "Angle distal :" en rouge (#d9534f) et en gras -->
                    Angle distal :
                </strong>

                <span id="angle-distal" style="font-weight: bold;">â€“</span> Â°
                <!-- Affiche dynamiquement la valeur de lâ€™angle distal -->
                <!-- style="font-weight: bold;" : rend la valeur chiffrÃ©e plus visible pour l'utilisateur -->
                <!-- Le contenu de ce span est remplacÃ© dynamiquement en JavaScript via document.getElementById('angle-distal').textContent -->

                &nbsp;&nbsp;&nbsp;
                <!-- Ajoute un espacement horizontal visuel entre les deux textes (distal / proximal) -->

                <strong style="color: #007bff; font-weight: bold;">
                    <!-- Affiche le texte statique "Angle proximal :" en bleu (#007bff) et en gras -->
                    Angle proximal :
                </strong>

                <span id="angle-proximal" style="font-weight: bold;">â€“</span> Â°
                <!-- Affiche dynamiquement la valeur de lâ€™angle proximal -->
                <!-- Le style en gras permet de mieux lire la valeur en temps rÃ©el -->
                <!-- Ce span est aussi mis Ã  jour via JavaScript cÃ´tÃ© client -->
            </div>


            <div id="graph-amplitude"></div>
            <!-- Graphique dâ€™amplitude dynamique -->
        </div>
    </div>

    <div style="text-align: center; margin-top: 10px;">
        <!-- Zone contenant le bouton pour cacher/afficher les graphes -->
        <button id="toggleGraphsButton" class="graph-toggle-button">
            Cacher les graphiques
        </button>
        <!-- Ce bouton agira sur tout le bloc #measurement-page via JS -->
    </div>
</div>

<!-- âœ… Nouveau conteneur en dehors du bloc #measurement-page -->
<div class="new-measure-container">
    <!-- Cette zone reste toujours visible mÃªme si les graphiques sont masquÃ©s -->
    <button id="newMeasureButton">Nouvelle mesure</button>
    <!-- Bouton indÃ©pendant qui redirige l'utilisateur vers la page d'accueil -->
</div>


{% endblock %}
<!-- Fin du bloc principal de contenu propre Ã  la page de mesure -->

{% block scripts %}
<!-- Bloc dâ€™inclusion des scripts spÃ©cifiques Ã  cette page (JS externes, bibliothÃ¨ques CDN, etc.) -->
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <!-- Charge la bibliothÃ¨que Socket.IO (version CDN) -->
    <!-- UtilisÃ©e pour Ã©tablir une connexion en temps rÃ©el (WebSocket) entre le navigateur et le serveur Python/Flask -->


    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Charge la bibliothÃ¨que Plotly.js permettant de dessiner des graphiques interactifs (ex : force, amplitude) -->

    <script>
        window.DEBUG = true;  // Activer ou dÃ©sactiver tous les logs
        window.blockedPhalange = "{{ patient.phalange|lower }}";
        <!-- Injecte la phalange actuelle dans une variable JavaScript globale accessible dans measurement.js -->
        if (window.DEBUG) {
            console.log("ðŸ“¦ Phalange bloquÃ©e (depuis Jinja):", window.blockedPhalange);
            // <!-- Affiche la valeur dans la console pour vÃ©rification/debug -->
        }
    </script>

    <script src="{{ url_for('static', filename='js/measurement.js') }}"></script>
    <!-- Fichier JavaScript principal de la page, gÃ¨re l'affichage, les Ã©vÃ©nements et les interactions dynamiques -->
    <!-- url_for(...) : Permet de pointer dynamiquement vers ce fichier dans le dossier static/js -->


{% endblock %}
<!-- Fin du bloc des scripts propres Ã  cette page -->

